{% extends "base.html" %}

{% block title %}EveryVote - University Elections{% endblock %}

{% block extrahead %}
<meta property="og:url" content="http://www.everyvote.org/" />
<meta property="og:description" content="Learn about and contact your university candidates in one convenient place for free with EveryVote." />
<meta property="og:image" content="/static/images/everyvote_rectangle_logo_facebook.png" />
{% endblock %}

{% block box1 %}

<div class="infobox">

  <div class="infobox-inside-home">
  <a href="/"><img style="margin:0 0 15px 0; padding:0;" class="img-responsive" src="/static/images/everyvote_rectangle_logo_2.png" alt="EveryVote logo" /></a>
  <a style="color:#333" href="http://www.everyvote.org/elections/1/"><h2 style="font-size:200%; font-family:'Oswald', sans-serif; margin:0 0 25px 0; padding:0; text-align:center;">open source election information platform</h2></a>
    <div class="infobox-selector-yellow">
      <div class="infobox-selector-title">
        <h4>Find your university:</h4>
      </div>
      <div class="infobox-selector-dropdown">
        <form class="form-inline" method="POST">{% csrf_token %}
          <div class="input-group">
            <input size="75" type="text" data-provide="typeahead" placeholder="Type university name here" class="searchAhead form-control" name="i1" />
            <span class="input-group-btn">
              <button type="submit" class="btn btn-default">Go!</button>
            </span>
        </form>
      </div>
      <div class="infobox-selector-helper-text">
        <span class="help-block">If your university is missing you can <a href="/universities/add/">add it yourself</a> or <a href="/contact/">contact us</a> and we'll set it up for you.</span>
      </div>
    </div>
    </div>
    {% if featured_elections %}
    <div class="infobox-panel">
      <h2 style="margin:30px 0 10px 0; font-family: 'Oswald', sans-serif;">Featured Elections</h2>
      <hr style="clear:both; margin:0 0 15px 0; padding:0;">
      <div class="featured-elections">
        {% for election in featured_elections|slice:":10" %}
          <div class="{{ forloop.counter|divisibleby:2|yesno:'featured-election-light, featured-election-dark' }}">
            <div class="featured-elections-picture-small">
              {% if election.constituency.parent_constituency.profile_picture %}
                <a href="/elections/{{ election.id }}/"><img src="/static/uploaded_files/{{election.constituency.parent_constituency.profile_picture}}" /></a>
              {% endif %}
            </div>
            <div class="featured-elections-text-small">
              <a href="/elections/{{ election.id }}/"><h4>{{ election.constituency.parent_constituency.name }} - {{ election.constituency.name }} - {{ election.name }}</h4>
              <p style="display:inline;">{{ election.about|truncatechars:200 }}</p></a>
              <div style="clear:both;">
              </div>
            </div>
          </div>
          <hr style="margin:15px 0 15px 10px; clear:both">
        {% endfor %}
        <div style="clear:both;">
        </div>
      </div>
    {% endif %}
    </div>
    <div class="infobox-panel">
      <h2 style="font-family: 'Oswald', sans-serif;">Control Panel</h2>
      <hr style="clear:both; margin:0; padding:0;">
      <div class="home-button-bar">
      <div class="btn-group">
        <button class="btn btn-primary" onclick="location.href='/universities/add'"><i class="icon-flag"></i>&nbsp Add University</button>
        <button class="btn btn-primary" onclick="location.href='/organizations/add'"><i class="icon-group"></i>&nbsp Add Organization</button>
        <button class="btn btn-primary" onclick="location.href='/offices/add'"><i class="icon-shield"></i>&nbsp Add Office</button>
        <button class="btn btn-primary" onclick="location.href='/elections/add'"><i class="icon-list-ul"></i>&nbsp Add Election</button>
        <button class="btn btn-primary" onclick="location.href='/candidates/add'"><i class="icon-check"></i>&nbsp Run for Office</button>
      </div>
      <div style="clear:both;">
      </div>
    </div>
  </div>
</div>
</div>

<script type="text/javascript">
  $('.searchAhead').typeahead({
      name: 'Search',
      remote: {
          url: '/lookup/universities/?query=%QUERY'
      }
      matcher: function(item) {
                if (item.toLowerCase().indexOf(this.query.trim().toLowerCase()) != -1) {
                    return true;
                }
                if (item.toUpperCase().indexOf(this.query.trim().toUpperCase()) != -1) {
                    return true;
                }
                var query = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&');
                query = query.replace(/a/ig, '[a\341\301\340\300\342\302\344\304]');
                query = query.replace(/e/ig, '[e\351\311\350\310\352\312\353\313]');
                query = query.replace(/i/ig, '[i\355\315\354\314\356\316\357\317]');
                query = query.replace(/o/ig, '[o\363\323\362\322\364\324\366\326]');
                query = query.replace(/u/ig, '[u\372\332\371\331\373\333\374\334]');
                query = query.replace(/c/ig, '[c\347\307]');
                if(item.toLowerCase().match(query.toLowerCase())){
                    return true;
                }
            }
  }).on('typeahead:selected', function(event, datum) {
      window.location = "universities/" + datum.number + "/";
  });
</script>
{% endblock %}
