{% extends "base.html" %}
{% load comments %}

{% block title %}{{ candidate.user.first_name }} {{ candidate.user.last_name }} Running for {{ candidate.office }} of {{ candidate.election.constituency }}{% endblock %}

{% block box1 %}
<div class="infobox">
  <div class="infobox-inside">
    <div class="infobox-name">
      <a href="/universities/{{ candidate.election.constituency.parent_constituency.id }}">{{ candidate.election.constituency.parent_constituency.name }}</a><br />
      <a href="/organizations/{{ candidate.election.constituency.id }}">{{ candidate.election.constituency.name }}</a><br />
      <a href="/elections/{{ candidate.election.id }}">{{ candidate.election.name }}</a><br />
      Candidate
    </div>
    
    <!--infobox buttons-->
    {% if user in election.constituency.parent_constituency.administrators.all %}
      <a href="/universities/update/{{candidate.election.constituency.parent_constituency.id}}"><button class="btn btn-warning infobox-university-button"><span class="glyphicon glyphicon-pencil"></span> Edit University</button></a>
    {% endif %}
    <button class="btn btn-info infobox-share-button" data-toggle="modal" href="#shareelectionModal">Share Candidate</button>
      {% if user in candidate.election.constituency.moderators.all %}
        <a href="/organizations/update/{{candidate.election.constituency.id}}"><button class="btn btn-warning infobox-button"><span class="glyphicon glyphicon-pencil"></span> Edit Organization</button></a>
        <a href="/elections/update/{{candidate.election.id}}"><button class="btn btn-warning infobox-button"><span class="glyphicon glyphicon-pencil"></span> Edit Election</button></a>
      {% endif %}
      {% if candidate.user.id = user.userprofile.id %}
        <a href="/candidates/update/{{candidate.id}}"><button class="btn btn-warning infobox-button"><span class="glyphicon glyphicon-pencil"></span> Edit Candidate Profile</button></a>
      {% endif %}
    <!--/infobox buttons-->

    <hr style="clear:both; padding:5px 0; margin:5px 0;">

    {% if candidate.user.profile_picture %}  
      <div class="infobox-candidate-picture">
        <p><img src="/static/uploaded_files/{{candidate.user.profile_picture}}" /></p>
      </div>
    {% endif %}
    <div class="infobox-name">
      {{ candidate.user.first_name }} {{ candidate.user.last_name }}
    </div>
    <div class="infobox-below-name">
      <strong>Running for: </strong>{{ candidate.office.name }}
    </div>
    <hr style="clear:both; padding:0; margin:5px 0;">
    <div class="infobox-about">
      {% if candidate.key_issues %}
        <p><strong>Key Issues: </strong>{{ candidate.key_issues }}</p>
      {% endif %}
      <p><strong>About Me</strong>{{ candidate.about|linebreaks|urlize }}</p>
      {% if candidate.user.twitter_name or candidate.user.facebook_page or candidate.user.linkedin_page or candidate.user.personal_homepage %}
        <hr style="clear:both; padding:5px 0; margin:5px 0;">
        <p><strong>Contact Info</strong></p>
      {% endif %}
      {% if candidate.user.twitter_name %}
        <p><a target="_blank" href="https://www.twitter.com/{{ candidate.user.twitter_name|slice:"1:" }}">Twitter</a></p>
      {% endif %}
      {% if candidate.user.facebook_page %}
        <p><a target="_blank" href="{{ candidate.user.facebook_page }}">Facebook page</a></p>
      {% endif %}
      {% if candidate.user.linkedin_page %}
        <p><a target="_blank" href="{{ candidate.user.linkedin_page }}">Linkedin page</a></p>
      {% endif %}
      {% if candidate.user.personal_homepage %}
        <p><a target="_blank" href="{{ candidate.user.personal_homepage }}">Homepage</a></p>
      {% endif %}
    </div>
  </div>
</div>
<div class="modal fade" id="sharecandidateModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 class="modal-title">Share this Candidate</h3>
      </div>
      <div class="modal-body">
        <strong>Copy the link below to share this candidate page:</strong>
        <br />
        <br />
        <p>www.everyvote.org/candidates/{{candidate.id}}</p>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="comments">
  <h3>Comments</h3>
  {% get_comment_count for candidate as comment_count %}
  {{ comment_count }} comment{{ comment_count|pluralize }}
  <div class="comment_form">
  {% if user.is_authenticated %}
    {% get_comment_form for candidate as form %}
    <form action="{% comment_form_target %}" method="POST">
      {% csrf_token %}
      {{ form.comment }}
      {{ form.honeypot }}
      {{ form.content_type }}
      {{ form.object_pk }}
      {{ form.timestamp }}
      {{ form.security_hash }}
      <input type="hidden" name="name" value="{{ user }}" />
      <input type="hidden" name="email" value="{{ user.email|default:'d@ummy.com' }}" />
      <input type="hidden" name="url" value="" />
      <input type="hidden" name="next" 
          value="/candidates/{{ candidate.id }}" />
      <input type="submit" class="btn btn-primary" value="Add comment" id="id_submit" />
    </form>
  {% else %}
    <p>Please <a href="/accounts/login">log in</a> to leave a comment.</p>
  {% endif %}
</div>

{% get_comment_list for candidate as cmt_list %}
  {% for comment in cmt_list %}
    <div class="comment">
      <p><a href="/users/{{ comment.user }}">{{ comment.user_name }}</a> - {{ comment.submit_date }}
      {% if user.is_authenticated and comment.user == user %}
        <a href="/comments/delete/{{ comment.id }}">remove</a>
      {% elif user.is_authenticated and user in election.moderators.all %}
        <a href="/comments/delete/{{ comment.id }}">remove</a>
      {% endif %}            
      </p>
      <p>{{ comment.comment }}</p>
    </div>
  {% endfor %}
  <br />

{% endblock %}
